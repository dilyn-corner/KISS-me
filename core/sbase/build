#!/bin/sh -e

# Make sbase tar accept arguments without dash
patch -p1 < tar-dash-remove.patch

make LDFLAGS="$LDFLAGS -static" sbase-box
make DESTDIR="$1" PREFIX=/usr   sbase-box-install

# Unlink things we'd rather use toybox for
unlink "$1/usr/bin/["
unlink "$1/usr/bin/basename"
unlink "$1/usr/bin/cal"
unlink "$1/usr/bin/cat"
unlink "$1/usr/bin/chgrp"
unlink "$1/usr/bin/chmod"
unlink "$1/usr/bin/chown"
unlink "$1/usr/bin/chroot"
unlink "$1/usr/bin/cksum"
unlink "$1/usr/bin/cmp"
unlink "$1/usr/bin/comm"
unlink "$1/usr/bin/cp"
unlink "$1/usr/bin/cut"
unlink "$1/usr/bin/date"
unlink "$1/usr/bin/dd"
unlink "$1/usr/bin/dirname"
unlink "$1/usr/bin/du"
unlink "$1/usr/bin/echo"
unlink "$1/usr/bin/ed"
unlink "$1/usr/bin/env"
unlink "$1/usr/bin/expand"
unlink "$1/usr/bin/expr"
unlink "$1/usr/bin/false"
unlink "$1/usr/bin/find"
unlink "$1/usr/bin/flock"
unlink "$1/usr/bin/fold"
unlink "$1/usr/bin/getconf"
unlink "$1/usr/bin/grep"
unlink "$1/usr/bin/head"
unlink "$1/usr/bin/hostname"
unlink "$1/usr/bin/install"
unlink "$1/usr/bin/join"
unlink "$1/usr/bin/kill"
unlink "$1/usr/bin/link"
unlink "$1/usr/bin/ln"
unlink "$1/usr/bin/logger"
unlink "$1/usr/bin/logname"
unlink "$1/usr/bin/ls"
unlink "$1/usr/bin/md5sum"
unlink "$1/usr/bin/mkdir"
unlink "$1/usr/bin/mkfifo"
unlink "$1/usr/bin/mknod"
unlink "$1/usr/bin/mktemp"
unlink "$1/usr/bin/mv"
unlink "$1/usr/bin/nice"
unlink "$1/usr/bin/nl"
unlink "$1/usr/bin/nohup"
unlink "$1/usr/bin/od"
unlink "$1/usr/bin/paste"
unlink "$1/usr/bin/pathchk"
unlink "$1/usr/bin/printenv"
unlink "$1/usr/bin/printf"
unlink "$1/usr/bin/pwd"
unlink "$1/usr/bin/readlink"
unlink "$1/usr/bin/renice"
unlink "$1/usr/bin/rev"
unlink "$1/usr/bin/rm"
unlink "$1/usr/bin/rmdir"
unlink "$1/usr/bin/sed"
unlink "$1/usr/bin/seq"
unlink "$1/usr/bin/setsid"
unlink "$1/usr/bin/sha1sum"
unlink "$1/usr/bin/sha224sum"
unlink "$1/usr/bin/sha256sum"
unlink "$1/usr/bin/sha384sum"
unlink "$1/usr/bin/sha512sum"
unlink "$1/usr/bin/sleep"
unlink "$1/usr/bin/sort"
unlink "$1/usr/bin/split"
unlink "$1/usr/bin/strings"
unlink "$1/usr/bin/sync"
unlink "$1/usr/bin/tail"
unlink "$1/usr/bin/tar"
unlink "$1/usr/bin/tee"
unlink "$1/usr/bin/test"
unlink "$1/usr/bin/tftp"
unlink "$1/usr/bin/time"
unlink "$1/usr/bin/touch"
unlink "$1/usr/bin/tr"
unlink "$1/usr/bin/true"
unlink "$1/usr/bin/tsort"
unlink "$1/usr/bin/tty"
unlink "$1/usr/bin/uname"
unlink "$1/usr/bin/unexpand"
unlink "$1/usr/bin/uniq"
unlink "$1/usr/bin/unlink"
unlink "$1/usr/bin/uudecode"
unlink "$1/usr/bin/uuencode"
unlink "$1/usr/bin/wc"
unlink "$1/usr/bin/which"
unlink "$1/usr/bin/whoami"
unlink "$1/usr/bin/xargs"
unlink "$1/usr/bin/yes"
