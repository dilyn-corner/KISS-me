#!/bin/sh -e

# Make sbase tar accept arguments without dash
patch -p1 < tar-dash-remove.patch

make LDFLAGS="$LDFLAGS -static" sbase-box
make DESTDIR="$1" PREFIX=/usr   sbase-box-install

# Unlink sed, because '-i' is widey used
unlink "$1/usr/bin/sed"

# Toybox doesn't build with sbase sort
unlink "$1/usr/bin/sort"

# Two common greps requested by configures
cat >> "$1/usr/bin/egrep" << EOF
#!/bin/sh

/usr/bin/sbase-box grep -E "$@"
EOF

cat >> "$1/usr/bin/fgrep" << EOF
#!/bin/sh

/usr/bin/sbase-box grep -f "$@"
EOF

# Install the license
install -Dm755 LICENSE "$1/usr/share/LICENSES/sbase.license"
