export defCFLAGS="-march=native -mtune=native -O3 -fno-math-errno -pipe"

case $TYPE in
    pre-build)
        case $PKG in
            byacc | libressl | llvm | e2fsprogs | lame) # lto  broken
                export CFLAGS="$defCFLAGS"
                export CXXFLAGS="$defCFLAGS"
            ;;
            libass | libpng | pixman | opus | util-linux) # lto  broken
                export CFLAGS="$defCFLAGS"
                export CXXFLAGS="$defCFLAGS"
            ;;
            vim | mpv) # lto broken
                export CFLAGS="$defCFLAGS"
                export CXXFLAGS="$defCFLAGS"
            ;;
            ffmpeg | mesa | python | python2) # we forked these 
                export CFLAGS="$defCFLAGS"
                export CXXFLAGS="$defCFLAGS"
            ;;
            musl) # breaks everything
                export CFLAGS="$defCFLAGS"
                export CXXFLAGS="$defCFLAGS"
            ;;
            x264) # We can fix this at configure with -ffat-lto-objects
                  # in configure's little-endian test?
                export CFLAGS="$defCFLAGS"
                export CXXFLAGS="$defCFLAGS"
            ;;
        esac
    ;;
    post-build)
        case $PKG in
            kiss) # ensure we keep docs
            ;;
            libudev-zero) # install our helper script
                cc contrib/helper.c -o helper
                install -Dm755 helper "$DEST/usr/bin/helper"
            ;;
            *)
                rm -rf "$DEST/etc/bash_completions.d"
                rm -rf "$DEST/usr/lib/charset.alias"
                rm -rf "$DEST/usr/share/polkit-1"
                rm -rf "$DEST/usr/share/gettext"
                rm -rf "$DEST/usr/share/locale"
                rm -rf "$DEST/usr/share/info"
                rm -rf "$DEST/usr/share/doc"
                rm -rf "$DEST/usr/share/man"
                rm -rf "$DEST/usr/share/zsh"
            ;;
        esac
    ;;
esac
