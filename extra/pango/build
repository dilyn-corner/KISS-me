#!/bin/sh -e

export DESTDIR="$1"

patch -p1 < static.patch

CFLAGS=$(printf %s "$CFLAGS" | sed 's/-static//g')

sed -i "/subdir('tests')/d"    meson.build
sed -i "/subdir('examples')/d" meson.build

meson \
    --prefix=/usr \
    -Ddefault_library=static \
    -Dbuildtype=release \
    -Dgir=disabled \
    . build

ninja -C build
ninja -C build install
