#!/bin/sh -e

# Disable building 'cairo-sphinx'.
sed -i "s/BUILD_SPHINX_TRUE=/BUILD_SPHINX_TRUE='#'/"   configure
sed -i "s/BUILD_SPHINX_FALSE='#'/BUILD_SPHINX_FALSE=/" configure
sed -i 's/test perf//g' Makefile.in

export CFLAGS="$CFLAGS -DEGL_NO_X11"

# Hide a VERY obnoxious warning
CFLAGS=-Wno-enum-conversion ./configure \
    --prefix=/usr \
    --enable-tee \
    --enable-glesv2 \
    --disable-gl \
    --disable-egl \
    --disable-glx \
    --disable-xlib \
    --disable-trace \
    --disable-xcb-shm \
    --disable-valgrind \
    --disable-gtk-doc-html \
    --disable-xlib-xrender

make
make DESTDIR="$1" install
